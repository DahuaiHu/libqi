#from qibuild_code_generator import *
<%
def generate_argpush_list(count):
    t = "args.push_back(p%(count)d);"
    return generate_list(t, count, sep=" ")
%>
/*
* $autogen
*
*  Author(s):
*  - Chris Kilner  <ckilner@aldebaran-robotics.com>
*  - Cedric Gestes <gestes@aldebaran-robotics.com>
*
*  Copyright (C) 2010, 2012 Aldebaran Robotics
*/

#raw
#pragma once
#ifndef _QI_MESSAGING_OBJECT_HXX_
#define _QI_MESSAGING_OBJECT_HXX_

#include <qimessaging/buffer.hpp>

namespace qi {
#end raw
#for $i in $count

  /// <summary> Calls a method </summary>
  /// <returns> The response </returns>
  template <typename R${generate_typename_list($i, begin=True)}>
  qi::Future<R> Object::call(const std::string& method${generate_param_list($i, begin=True)}) {
    //will be deleted by metaCall
    qi::FunctorReturnPromise<R>      *promise = new qi::FunctorReturnPromise<R>();
    qi::Future<R>                     future;
    qi::Buffer                        breq;
    qi::DataStream                    ds(&breq);
    qi::FunctorParameters             request(&breq);

    R (*f)(${generate_param_list($i)})  = 0;
    std::string signature(method);
    signature += "::";
    signatureFromObject::value(f, signature);
    #for $j in range($i)
    ds << p${j};
    #end for
    future = promise->future();
    metaCall(metaObject()._methodsNameToIdx[method], signature, request, promise);
    return future;
  }
#end for

}
#raw
#endif  // _QI_MESSAGING_OBJECT_HXX_
#end raw
